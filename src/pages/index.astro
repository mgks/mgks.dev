---
import Layout from '../layouts/Layout.astro';
import TechStack from '../components/TechStack.astro';
import Highlight from '../components/Highlight.astro';
import { getCollection } from 'astro:content';
import { APPS } from '../data/config';

const allPosts = (await getCollection('blog', ({ data }) => {
    return data.date <= new Date(); 
})).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const featuredPosts = allPosts.filter(p => p.data.featured).slice(0, 2);

// Rollups: Tagged rollup, not featured
const rollupPosts = allPosts
    .filter(p => p.data.tags.includes('rollup') && !p.data.featured)
    .slice(0, 3); // 3 items looks best in the new grid
---

<Layout title="mgks.dev" description="Open source, problem solving and stories by Ghazi Khan.">
    
    <!-- Hero Section -->
    <section class="hero">
        <div class="mascot-wrapper">
            <div class="mascot-glow"></div>
            <img src="/assets/images/zen.gif" alt="Zen Mascot" class="mascot-img" />
        </div>
        <h1 class="hero-title">
            I build simple solutions <br />
            <span class="hero-subtitle">for complex problems<span class="text-accent">.</span></span>
        </h1>
        <p class="hero-desc">
            Hi, I'm <strong>Ghazi</strong>. I'm an open source developer focused on minimalism, performance, and ethical AI.
        </p>
        <div style="margin-bottom: 3rem;">
            <a href="/projects" class="icon-btn" style="width: auto; padding: 0.75rem 1.5rem; border-radius: 99px; border: 1px solid var(--border-color); font-size: 0.9rem;">
                See my work
            </a>
        </div>
        <TechStack />
    </section>

    <Highlight />

    <section class="section-py" style="margin: 2rem 0;">
        <div class="grid grid-2">
            {APPS.slice(0, 2).map(app => (
                <a href={app.link} target="_blank" class="project-card app-card" style="padding: 2.5rem;">
                    <div class="flex items-start justify-between mb-3">
                        {/* Logo / Icon */}
                        <div class="w-12 h-12 rounded-lg bg-surface-secondary border border-border flex items-center justify-center text-accent overflow-hidden">
                             {app.icon && app.icon.startsWith('<svg') ? (
                                <Fragment set:html={app.icon.replace('width="64"', 'width="24"').replace('height="64"', 'height="24"')} />
                             ) : (
                                <svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"/><g stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" fill="#00000" d="M6 2.972v.012h-.09q-.298 0-.562.121a1.5 1.5 0 0 0-.457.32 1.47 1.47 0 0 0-.42 1.035q0 .34.012.677.012.336 0 .665a5 5 0 0 1-.055.64q-.05.314-.168.603-.12.29-.324.552-.169.216-.413.403a2.3 2.3 0 0 1 .737.955q.12.289.168.608.05.31.055.64.012.324 0 .666-.012.33-.012.672 0 .304.111.573.119.265.309.468.196.196.457.319.263.115.563.115H6V14h-.09q-.47 0-.909-.185a2.3 2.3 0 0 1-.775-.53 2.2 2.2 0 0 1-.493-.753v-.001a3.5 3.5 0 0 1-.198-.824v-.002a6 6 0 0 1-.024-.87q.018-.433.018-.868 0-.297-.117-.566V9.4a1.4 1.4 0 0 0-.308-.465l-.002-.002a1.4 1.4 0 0 0-.455-.318h-.001a1.3 1.3 0 0 0-.557-.122H2v-.984h.09q.292 0 .557-.115.267-.123.456-.32.196-.201.309-.467.117-.27.117-.573 0-.435-.018-.869a6 6 0 0 1 .024-.863V4.3q.05-.43.197-.83v-.001a2.2 2.2 0 0 1 .494-.753A2.3 2.3 0 0 1 5 2.185Q5.441 2 5.911 2H6zm7.923 5.52H14v-.984h-.09q-.292 0-.556-.121l-.001-.001a1.4 1.4 0 0 1-.455-.318l-.002-.002a1.4 1.4 0 0 1-.307-.465l-.001-.002a1.4 1.4 0 0 1-.117-.566q0-.435.018-.869a6 6 0 0 0-.024-.87v-.001a3.5 3.5 0 0 0-.197-.824v-.001a2.2 2.2 0 0 0-.494-.753 2.3 2.3 0 0 0-.775-.53 2.3 2.3 0 0 0-.91-.185H10v.984h.09q.299 0 .562.115.26.123.457.32.19.201.309.467.11.27.11.573 0 .342-.011.672-.012.342 0 .665.006.333.055.64.05.32.168.609.12.29.324.552.169.216.413.403l-.031.025c.53.058 1.03.221 1.477.467"/><path fill="#ff570d" d="M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6"/></svg>
                             )}
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-bold mb-1 group-hover:text-accent transition-colors">{app.title}</h3>
                    <p class="text-sm text-muted line-clamp-2 mb-3">{app.desc}</p>
                </a>
            ))}
        </div>
    </section>

    <!-- Featured Writings -->
    {featuredPosts.length > 0 && (
        <section class="section-py">
            <div class="section-header">
                <h2 class="section-title">Featured Writings<span class="text-accent">.</span></h2>
                <a href="/blog" class="section-link">Read all &rarr;</a>
            </div>

            <div class="grid grid-2">
                {featuredPosts.map(post => (
                    <a href={`/blog/${post.slug}`} class="blog-card">
                        <div class="card-cover">
                            {post.data.image ? (
                                <img src={post.data.image} alt={post.data.title} />
                            ) : (
                                <div style="display: flex; align-items: center; justify-content: center; height: 100%; opacity: 0.1;">.*</div>
                            )}
                            <div class="date-badge">
                                {post.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                            </div>
                        </div>
                        <div class="card-body">
                            <h3 class="card-title">{post.data.title}</h3>
                            <p class="card-desc">{post.data.description}</p>
                        </div>
                    </a>
                ))}
            </div>
        </section>
    )}

    <!-- Latest Rollups (New Style) -->
    <section class="section-py" style="margin-top: 3rem;">
        <div class="rollup-section">
            <div class="rollup-header">
                <h2 class="rollup-title">Latest Rollups</h2>
                <a href="/tags/rollup" class="section-link">View all &rarr;</a>
            </div>
            
            <div class="rollup-grid">
                {rollupPosts.map(post => (
                    <a href={`/blog/${post.slug}`} class="rollup-card">
                        <div class="rollup-date">
                            {post.data.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                        </div>
                        <h3 class="rollup-heading">{post.data.title}</h3>
                    </a>
                ))}
                
                {rollupPosts.length === 0 && (
                    <p class="text-muted text-center py-4 w-full col-span-3">No rollups posted yet.</p>
                )}
            </div>
        </div>
    </section>
</Layout>